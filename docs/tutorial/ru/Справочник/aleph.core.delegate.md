Aleph\\Core\\Delegate
=====================



Общая информация
----------------

**Наследование:** нет

**Дочерние классы:** нет

**Интерфейсы:** IDelegate

**Источник:** `lib/core/delegate.php`



Класс `Delegate` расширяет понятие функции обратного вызова в php. Вместо них
вводится понятие делегата, который представляет собой объект класса `Delegate`
или строку в определённом формате, представляющую собой описание плана вызова
некоторой функции или некоторого метода класса.

Делегат является своего рода алиасом некоторого метода класса или функции. Вы
можете работать с ним точно так же как и с функцией которую он описывает.

Существует 7 основных типов строки делегата:

1.  **function** - вызов функции.

2.  **class::method** - вызов статического метода класса.

3.  **class->method** - вызов нестатического метода класса. Класс имеет пустой
    конструктор.

4.  **class[]** - вызов пустого конструктора класса.

5.  **class[n]** - вызов конструктора класса принимающего **n** параметров.

6.  **class[n]->method** - вызов нестатического метода класса. Конструктор
    класса принимает **n** параметров.

7.  **class@cid->method** - вызов нестатического метода веб-контрола.

Здесь **function** - название функции, **class** - название класса, **method** -
название метода класса, **n** - число параметров конструктора класса, **cid** -
уникальный или логический идентификатор веб-контрола.

Помимо перечисленных основных видов строк делегата существует два случая
контекстно зависимых делегатов:

-   **::method** - если определён страничный класс (переменная
    `Aleph\MVC\Page::$page`), то такой делегат аналогичен вызову
    соответствующего статического метода страничного класса. Если же страничный
    класс не определён, то будет вызван сответствующий метод класса `Aleph`.

-   **->method** - аналогично первому случаю, только применительно к
    нестатическим методам.



Общедоступные нестатические методы
----------------------------------



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public void __construct(mixed $callback)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$callback** - делегат, строка делегата или любой callable объект.

Конструктор класса. Парсит строку делегата и подготавливает делегат к вызову.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public string __toString()
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:** нет

Возвращает строковое представление делегата. Если вместо делегата используется
замыкание, то метод вернёт строку "Closure".



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public mixed __invoke(mixed $arg1, mixed $arg2, ...)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:** параметры метода или функции вызываемые делагатом.

Позволяет обращаться к объекту делегата как к методу. Пример:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// Создаём делегат для метода foo класса Test. конструктор класса 
// принимает два параметра.
$d = new Delegate('test[2]->foo');
// Вызываем метод foo и передаём в него параметр 'test'. В конструктор класса
// передаём параметры 'a' и 'b'.
$d('a', 'b', 'test');
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public mixed call(array $args = null)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$args** - массив параметров вызываемого делегата.

Вызывает делегируемый метод класса или функцию. Пример:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// Создаём делегат для метода foo класса Test. конструктор класса 
// принимает два параметра.
$d = new Delegate('test[2]->foo');
// Вызываем метод foo и передаём в него параметр 'test'. В конструктор класса
// передаём параметры 'a' и 'b'.
$d->call(['a', 'b', 'test']);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public function in(string|array $permissions)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$permissions** - разрешения на вызов делегата.

Проверяет делегат на соответствие заданным разрешениям. В качестве
`$permissions` может быть строка или массив строк следующих типов:

-   Класс с именем метода: **class::name** или **class->method**.

-   Имя класса: **class**.

-   Имя функции: **function**.

-   Пространство имён: **namespace**.

Метод вернёт TRUE, если делегат соответствует одному или более разрешению и
FALSE в противном случае. При этом будут проверяться пространство имён делегата,
имя класса, метода или функции на совпадение с разрешёнными. Пример:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// Создаём делегат.
$d = new Delegate('Aleph\Net\URL::current');
// Проверяем соотвествие делегата различным разрешениям.
$d->in('');                          // вернёт TRUE
$d->in('Aleph\\');                   // вернёт TRUE
$d->in('Aleph\Net\\');               // вернёт TRUE
$d->in('Aleph\Net\URL');             // вернёт TRUE
$d->in('Aleph\Net\URL::current');    // вернёт TRUE
$d->in('Aleph\Core\\');              // вернёт FALSE
$d->in('Aleph\Net\URL->current');    // вернёт FALSE
$d->in(['Aleph\Core\\', 'Aleph\\']); // вернёт TRUE
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public boolean isCallable(boolean $autoload = true)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$autoload** - определяет, нужно ли подключать класс, если класс
        делегата не определён.

Метод возвращает TRUE, если делегат может быть вызван и FALSE в противном
случае.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public array getInfo()
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:** нет

Возвращает полную информацию о делегате. Формат возвращаемого массива следующий:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
['class'   => ... [string] ..., 
 'method'  => ... [string] ...,
 'static'  => ... [boolean] ...,
 'numargs' => ... [integer] ...,
 'type'    => ... [string] ...,
 'cid'     => ... [string] ...]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

где **class** - имя класса делегируемого метода, **method** - название
делегируемого класса или функции, **static** - признак статического метода,
**numargs** - количество параметров конструктора делегируемого класса, **type**
- тип делегата, **cid** - уникальный или логический идентификатор веб-контрола.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public string getClass()
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:** нет

Возвращает имя делегируемого класса.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public string getMethod()
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:** нет

Возвращает имя делегируемого метода класса или функции.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public string getType()
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:** нет

Возвращает тип делегата: "function", "closure", "class" или "control".



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public array|boolean getParameters()
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:** нет

Возвращает массив параметров делегируемого метода класса, функции или замыкания
или FALSE в случае неудачи.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public object getClassObject(array $args = null)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$args** - массив параметров для конструктора делегируемого класса.

Возвращает объект делегируемого класса. Если тип делегата "function", то метод
вернёт NULL. Для типа делегата "control" метод вернёт объект веб-контрола (либо
FALSE, если контрола с таким ID нет).



Защищённые нестатические свойства
---------------------------------



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
protected string $callback
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Строковое представление делегата.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
protected string $class
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Название делегируемого класса.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
protected string $method
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Название делегируемого метода.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
protected boolean $static
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Содержит TRUE, если делегируемый метод статический. Если тип делегата "function"
или "closure", то значением свойства является NULL.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
protected integer $numargs
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Номер параметров конструктора делегируемого класса. Для делегатов типа
"function" или "closure" свойство равно NULL.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
protected string $cid
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Уникальный или логический идентификатор веб-контрола.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
protected string $type
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Тип делегата.
