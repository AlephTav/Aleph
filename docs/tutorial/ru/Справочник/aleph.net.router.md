Aleph\\Net\\Router
==================



Общая информация
----------------

**Наследование:** нет

**Дочерние классы:** нет

**Интерфейсы:** нет

**Источник:** `lib/net/router.php`



Класс является маршрутизатором запросов, т.е. позволяет по виду HTTP-запроса
выполнять определённые, заранее заданные действия.

Каждое действие привязывается к одному или нескольким методам текущего
HTTP-запроса и должно соотвествовать URL определённого вида. Сопостовление с URL
осуществляется путём задания соотвествующего регулярного выражения. Причём само
регулярное выражение является надмножеством Perl-совместимых регулярных
выражений (PCRE), в котором некоторые символы имеют специальное значение:

-   Символ #. Используется для выделения некоторой части URL в переменную.
    Например, шаблон `category/#category#/#ID#` будет соотвествовать следующим
    URL:

    -   category/my_first_category/5

    -   category/my_second_category/10

    -   category/my_third_category/15

    -   ...

    При этом, переменной category будут соотвествовать значения:
    my_first_category, my_second_category, my_third_category и т.д. А переменной
    ID значения: 5, 10, 15 и т.д.

    Если требуется использовать символ # без специального значения, то вам нужно
    экранировать его с помощью обратного слэша:
    `category/#category#/#ID#\#fragment`.

-   Символ |. Используется для задания регулярного выражения для переменной
    шаблона. Например, если мы хотим ограничить переменную ID из предыдущего
    примера только целыми числами, то мы можем написать такое регулярное
    выражение: `category/#category#/#ID|[0-9]+#`. Если после символа |
    встретится ещё один такой символ, то он будет трактоваться как обычный
    символ альтернативы в регулярных выражениях.



Общедоступные нестатические методы
----------------------------------



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public Aleph\Net\Router bind(string $regex, mixed $action, string|array $methods = '*')
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$regex** - регулярное выражение (надмножество PCRE), соотвествующее
        некоторому URL или его части.

    -   **$action** - делегат, строка делегата или любой callable объект,
        вызываемые в случае совпадаения URL с регулярным выражением **$regex**.

    -   **$methods** - массив HTTP-методов для которых следует выполнить
        сопоставление URL с регулярным выражением.

Позволяет связать некоторый делегат с определёнными URL для заданных
HTTP-методов.

Вызов делегата произойдёт только в том случае, если метод текущего HTTP-запроса
соответствует одному из заданных методов и регулярное выражение соотвествует URL
текущего запроса.

Вместо массива HTTP-методов можно передавать строку в которой названия методов
разделены символом "|". Например: GET|POST|HEAD. Также параметр `$methods` может
быть равен символу "\*", что эквивалентно методам GET, PUT, POST и DELETE.  Если
`$methods` равен "@", то это эквивалентно заданию всех HTTP-методов: GET, PUT,
POST, DELETE, HEAD, OPTIONS, TRACE и CONNECT.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public Aleph\Net\Router redirect(string $regex, string $redirect, string|array $methods = '*', mixed $callback = null)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$regex** - регулярное выражение (надмножество PCRE), соотвествующее
        некоторому URL или его части.

    -   **$redirect** - URL для редиректа.

    -   **$methods** - массив HTTP-методов для которых следует выполнить
        сопоставление URL с регулярным выражением.

    -   **$callback** - делегат, который будет вызван вместо редиректа.

Осуществляет редирект по указанному адресу.

URL для редиректа может содержать переменные шаблона `$regex`, которые будут
заменены на соотвествующие значение. Например, если для URL шаблона вида
`category/#category#/#ID#` задать URL для редиректа `post/#ID#/#category#`, то
обработка запроса с URL равном `category/foo/111` приведёт к редиректу на URL
`post/111/foo`.

Редиректа не произойдёт, если в качестве последнего аргумента метода передать
некоторый делегат. Вместо редиректа будет вызван этот делегат и в него будет
передан полностью сформированный URL для редиректа.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public Aleph\Net\Router secure(string $regex, boolean $flag, string|array $methods = '*', mixed $callback = null)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$regex** - регулярное выражение (обычное  PCRE), соотвествующее
        некоторому URL или его части.

    -   **$flag** - разрешает или запрещает использование защищённого протокола.

    -   **$methods** - массив HTTP-методов для которых следует выполнить
        сопоставление URL с регулярным выражением.

    -   **$callback** - делегат, который будет вызван вместо редиректа.

Разрешает или запрещает использование HTTPS протокола для заданного шаблона URL.
В случае, если URL текущего запроса соответствует заданному шаблону (параметр
`$regex`) и параметр `$flag` равен TRUE, то произойдёт редирект на тот же URL,
но уже с протоколом HTTPS. Если `$flag` равен FALSE, то редирект приведёт к
смене протокола на HTTP.

Последний аргумент метода определяет делегат, который будет вызываться вместо
редиректа. В делегат передаётся URL для редиректа.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public Aleph\Net\Router remove(string $regex, string $type = null, string|array $methods = '*') 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$regex** - регулярное выражение, соотвествующее некоторому URL или его
        части.

    -   **$type** - определяет тип обработчика URL шаблонов, может быть одним из
        трёх значений: bind, redirect или secure.

    -   **$methods** - массив HTTP-методов для которых следует выполнить
        сопоставление URL с регулярным выражением.

Удаляет делегат ассоциированный с некоторым URL-шаблоном для заданных
HTTP-методов.

Если тип обработчика (параметр `$type`) не определён, то делегат будет удалён
для всех трёх обработчиков шаблонов.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public Aleph\Net\Router clean(string $type = null)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$type** - определяет тип обработчика URL шаблонов, может быть одним из
        трёх значений: bind, redirect или secure.

Удаляет все делегаты для одного или всех типов обработчиков шаблонов.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public Aleph\Net\Router component(integer $component)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$component** - константа или комбинация констант класса
        `Aleph\Net\URL`, определяющих к каким компонентам URL запроса будет
        применяться регулярное выражение определённое в методе `bind()`,
        `redirect()` или `secure()`.

Позволят указать какую часть URL запроса следует использовать для сопоставления
с регулярными выражениями URL-шаблонов.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public Aleph\Net\Router validation(array $validation)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$validation** - массив регулярных выражений для переменных
        URL-шаблона.

Метод позволяет задать проверку для переменных шаблона по регулярному выражению.
Параметром метода является ассоциативный массив, ключами которого являются
названия переменных шаблона, а значениями - регулярные выражения для проверки
значений соотвествующих переменных.

Если хотя бы одна переменная не совпадёт со своим регулярным выражением, то
соотвествующее действие маршрутизатора не будет выполнено.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public Aleph\Net\Router args(array $args)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$args** - массив параметров, которые будут переданны в делегат.

Задаёт массив параметров для передачи в соотвествующий делегат. Если URL-шаблон
содержит переменные шаблона, то делегат получит в первую очередь параметры
`$args` и только затем параметры соотвесвующие переменным шаблона.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public Aleph\Net\Router extra($parameter = 'extra')
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметр:**

    -   **$parameter** - имя аргумента делегата, в который будет передан массив
        значений переменных шаблона.

Определяет имя аргумента делегата для передачи в него значений переменных
шаблона.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public Aleph\Net\Router coordinateParameterNames(boolean $flag = true)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$flag** - определяет нужно ли синхронизировать названия параметров
        делегата и переменных URL-шаблона.

Включает или отключает синхронизацию названий переменных URL-шаблона и названий
параметров соответствующего  делегата. По умолчанию синхронизация отключена.
Если же синхронизация включена, то в делегат будут переданы только те переменные
шаблона, имена которых совпадают с названиями параметров делегата.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public Aleph\Net\Router ignoreWrongDelegate(boolean $flag = true)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$flag** - определяет нужно ли проверять делегат на корректность.

Если параметр метода равен TRUE, то делегат который не может быть вызван будет
пропущен и маршрутизатор продолжит свою работу. Если параметр равен FALSE, то
при попытке вызвать некорректный делегат будет выброшено исключение. По
умолчанию игнорирование делегатов не способных к вызовам отключено.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
public array route(string|array $methods = null, string|Aleph\Net\URL $url = null)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Параметры:**

    -   **$methods** - HTTP-метод или методы, URL-шаблоны которых следует
        анализировать. Если параметр не задан, то будет использован HTTP-метод
        текущего запроса.

    -   **$url** - URL для сопоставления с шаблонами. Если параметр не задан, то
        будет взят URL текущего запроса.

Проверяет URL запроса на соответствие некоторому шаблону URL для заданного
HTTP-метода. Если совпадение найдено, то будет вызван делегат, ранее привязанный
к этому шаблону.

Метод вовращает массив следующей структуры:

`['success' => ... [boolean] ..., 'result' => ... [mixed] ...]`

Первый элемент массива содержит TRUE, если совпадение с шаблоном найдено и FALSE
в противном случае. Второй элемент содержит результат вызова делегата.
