Шаблоны и шаблонизатор
======================



Под шаблонами понимается любой текст или содержимое файла, которые содержат
исполняемые конструкции языка шаблонов и поэтому могут быть модифицированны в
процессе работы вашего приложения. В Aleph фрэймворке в качестве языка шаблонов
используется язык PHP. Для упрощения работы с шаблонами существует специальный
класс шаблонизатор - **Aleph\Core\Template**.

Рассмотрим работу с классом на примере простого HTML-шаблона:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<html>
<head>
<title><?=$title;?></title>
</head>
<body>
<?=$text;?>
</body>
</html>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Создадим экземпляр класса:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
$tpl = new Template('/path/to/my/template');
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Первый параметр конструктора класса это либо путь к файлу шаблона, либо сам
шаблон.

После того как экземпляр класса создан мы можем получить шаблон при помощи
метода **getTemplate**:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
$template = $tpl->getTemplate();
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Или переопределить шаблон с помощью метода **setTemplate**:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
$tpl->setTemplate('/path/to/new/template');
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Как и в случае конструктора, параметр метода это путь к файлу шаблона, либо сам
шаблон.

Теперь зададим значения двух переменных шаблона. Сделать это можно обращаясь к
переменным шаблона как к свойствам класса (перегрузка свойств):

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// Задаём значение переменной title.
$tpl->title = 'Some Title';
// Задаём значение переменной text.
$tpl->text = 'Hello World!';
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Переменные определяемые подобным образом (через пергрузку свойств) являются
локальными переменными. Существуют также глобальные переменные шбалонов. Разница
между ним в том, что глобальные переменные определяются для всех шаблонов без
исключения. А локальные переменные существуют лишь для конкретно заданного
шаблона. При этом, если название локальной переменной совпадает с название
глобальной переменной, то значение локальной переменной переопределит значение
глобальной.

Создать глобальную переменную шаблона можно следующим образом:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
$tpl['foo'] = 'some vlaue';
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Переменная **foo** будет определена как глобальная, и станет доступной во всех
шаблонах.

Получить массив глобальных переменных шаблонов можно так:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
print_r(Template::getGlobals());
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Вы также можете задать все глобальные переменные сразу:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Template::setGlobals(['var1' => 'val1', 'var2' => 'val2', ...], true);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Первый параметр метода - ассоциативный массив глобальных переменныйх. Второй
параметр метода отвечает за слияние новых глобальных переменных со старыми. По
умолчанию значение FALSE.

Аналогичным образом можно задать (или получить) значения всех локальных
переменных:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// Устанавливаем значения локальных переменных.
$tpl->setVars(['var1' => 'val1', 'var2' => 'val2', ...], false);
// Получаем значения локальных переменных.
print_r($tpl->getVars());
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Параметры метода **setVars** полностью эквивалентны параметрам метода
**setGlobals**.

После того как все переменные шаблона определены мы можем обработать шаблон и
получить результат. Достигается это вызовом метода **render**:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
$result = $tpl->render();
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Вы также можете работать с объектом шаблонизатора как со строкой (реализация
магического метода **__toString**).

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
echo 'Result is ' . $tpl;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
