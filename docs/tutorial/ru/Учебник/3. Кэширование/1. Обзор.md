Обзор
=====



Фрэймворк позволяет работать с тремя типами систем кэширования, различающихся
способом и местом хранения данных: файловое кэширование, кэширование в памяти на
базе расширения APC и кэширование в памяти на базе расширения memcache.

Настройки кэширования задаются в переменной **cache** конфигурационного файла.
Значением этой переменной является ассоциативный массив, элементы которого
определяют тип кэша и его дополнительные параметры:

-   **type** - тип кэша, может быть одним из трёх значений: **memory**, **apc**
    и **file**. Если тип кэша не указан, то будет использоваться файловое
    кэширование.

-   **directory** - директория кэширования или её алиас для файлового кэша. Если
    директория кэша не определена, то будет использован алиас **cache**.

-   **gcProbability** - вещественное число определяющее вероятность (в
    процентах) срабатывания сборщика мусора кэша.

-   **compress** - булевый параметр отвечающий за сжатие данных находящихся в
    памяти. Значение по умолчанию FALSE. Параметр предназначен для типа кэша
    **memory**.

-   **servers** - массив серверов для подключения к memcached. Более подробную
    информацию о структуре этого массивы вы найдёте [тут][1]. Параметр
    используется только для кэша типа **memory**.

Перечисленные параметры кэша определяют поведение внутреннего кэша фрэймворка,
который используется различными его модулями для кэширования необходимой
информации. Получить объект класса для работы с внутренним кэшем фрэймворка
можно следующим образом:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
$cache = Aleph::getInstance()->cache();
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Вы также можете создать свой собственный объект для кэширования. Для этого
предназначен статический метод **getInstance** класса **Aleph\Cache\Cache**.
Метод принимает в качестве первого параметра тип кэша (**memory**, **apc** или
**file**), а в качестве второго массив дополнительных параметров указанного типа
кэша.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
$cache = \Aleph\Cache\Cache::getInstance('memory', ['compress' => true]);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Если метод **getInstance** вызван без параметров, то будут использованны
настройки кэша указанные в соотвествующей конфигурационной переменной.

Кроме этого существует возможность заменять внутренний кэш фрэймворка:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// Создаём новый объект кэша.
$cache = Cache\Cache::getInstance('apc');
// Заменяем внутренний кэш фрэймворка.
Aleph::getInstance()->cache($cache);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~



Особенности различных типов кэширования
---------------------------------------



Существуют различные нюансы при использовании различных типов кэша. В частности,
разные виды кэша имеют свою максимально возможную продолжительность жизни данных
в кэше. Для типов **apc** и **memory** максимальная продолжительность хранения
данных составляет один месяц. По истечении этого времени данные будут
уничтожены. Для файлового кэша максимальная продолжительность хранения данных
неограничена. Однако из практических соображений это время устанавливается
равным одному году.

Вы можете устанавливать и читать продолжительность жизни кэша с помощью
соотвествующих методов:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// Получаем объект кэширования.
$cache = Aleph::getInstance()->cache();
// Узнаём максимальное время жизни кэша.
echo $cache->getVaultLifeTime();
// Устанавливаем новое время жизни (в секундах) кэша.
$cache->setVaultLifeTime(108000);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Второй особенностью использования разных типов кэшей является сборщик мусора.
Под сборщиком мусора понимается механизм удаления из кэша просроченных данных.
Для систем кэширования хранящих данные в памяти (типы **memory** и **apc**)
сборщик мусора реализуется на уровне соответствующего расширения php. Для
файлового кэша сборщик мусора реализуется на уровне фрэймворка. Вы можете
вызывать его в своём коде при необходимости:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// Получаем объект кэширования.
$cache = Aleph::getInstance()->cache();
// Вызываем сборщик мусора (100% вероятность).
$cache->gc();
// Вызываем сборщик мусора с 10% вероятностью.
$cache->gc(10);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Файловый кэш сохраняет все свои данные в директории, которую можно прочитать или
задать при помощи соотвествующих методов:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// Получаем объект кэширования.
$cache = Aleph::getInstance()->cache();
// Читаем текущую директори кэша.
echo $cache->getDirectory();
// Задаём новую директорию кэша.
$cache->setDirectory('/path/to/new/directory');
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

[1]: <http://php.net/manual/ru/memcache.addserver.php>
