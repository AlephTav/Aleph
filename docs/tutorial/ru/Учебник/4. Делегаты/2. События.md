События
=======



Одним из наиболее очевидных применений делегатов является реализация шаблона
проектирования "[Наблюдатель][1]". Во фрэймворке реализация этого патерна
представлена классом **Aleph\Core\Event**.

Класс содержит статические методы, позволяющие связывать какое-либо событие с
одним или несколькими делегатами. Добавление делегата к событию происходит с
помощью метода **listen**:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Event::listen('myEvent', 'MyClass::method1', 1);
Event::listen('myEvent', [new MyClass(), 'method2'], 2);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Первый параметр метода это название события, второй - делегат, оссоциированный с
этим событием. Третий параметр метода это целое число, отвечающее за приоритет
вызова делегата. Делегаты вызываются в порядке убывания их приоритета (сначала
вызываются делегаты с большим приоритетом, потом с меньшим). Если приоритет не
указан, то он считается равным нулю.

Инициация события осуществляется при помощи метода **fire**:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Event::fire('myEvent', ['arg1', 'arg2', ...]);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Второй параметр метода определяет массив произвольных значений, которые будут
переданны в каждый делегат события в качестве аргументов.

Делегаты вызваются последовательно согласно их приоритету. При этом, если
какой-либо делегат вернёт FALSE, то вызов всех последующих делегатов (обладающие
меньшим приоритетом) не произойдёт.

Однажды инициированное событие может быть инициированно повторно. Это значит что
все делегаты события будут вызываться снова. Такое поведение не всегда
востребовано. Иногда необходимо осуществить лишь однократный вызов делегата или
делегатов. Вы легко можете осуществить это с помощью соотвествующего метода:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Event::once('myEvent', 'MyClass->foo', 5);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Параметры метода **once** соотвествуют параметрам метода **listen**. Разница
лишь в том, что после вызова делегата заданного с помощью метода **once** он
будет удалён из события.

Удалить делегат из события можно также вручную при помощи метода **remove**:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Event::remove('myEvent', 'MyClass->foo');
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Первым параметром метода является название события, а вторым - делегат.

Чтобы узнать общее количество делегатов подписанных на какое-либо событие, либо
общее количество делегатов во всех событиях необходимо воспользоваться методом
**listeners**:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// Получаем количество делегатов в событии "myEvent".
echo Event::listeners('myEvent');
// Получаем общее количество делегатов во всех событиях.
echo Event::listeners();
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

[1]: <http://en.wikipedia.org/wiki/Observer_pattern>
