Конфигурация приложения
=======================



Сразу после инициализации фрэймворка происходит конфигурирование вашего
приложения на основе данных конфигурационного файла. По умолчанию этот файл
хранится в папке **app/core**, но вы можете разместить его где пожелаете. Всё
что вам нужно будет сделать для этого, лишь поменять путь к файлу конфигурации в
**connect.php**

Конфигурационный файл не является необходимым элементом для функционирования
фрэймворка. Вы можете не использовать его. В таком случае значения всех
конфигурационных переменных примут значения по умолчанию (см. ниже).

Конфигурационные файлы могут быть двух типов:

1.  PHP-файлы. В таких файлах определяется и возвращается ассоциативный массив
    конфигурационных данных приложения. Каждый ключ массива представляет собой
    название какого-либо конфигурационного свойства, а каждое значение -
    соответствующее начальное значение свойства. Содержимое типичного
    конфигурационного php-файла может быть таким:

    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    <?php

    return ['property1' => ...,
            'property2' => ...,
            'property3' => ...,
            ...];
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

2.  INI-файлы. В этих файлах имена и значения параметров соответствуют названиям
    и значениям конфигурационных переменных. При этом, если значением
    конфигурационной переменной является ассоциативный массив, то такая
    переменная будет представлена в ini-файле как секция, название которой
    совпадает с названием переменной, а параметры секции соответствуют элементам
    массива. Если вы желаете использовать в качестве значения конфигурационной
    переменной многомерный или смешанный массив, то вы можете использовать json
    представление этого массива как значение параметра в ini-файле.



Основные конфигурационные свойства
----------------------------------



Эти свойства позволяют управлять анализом ошибок и исключений, логированием и
отображением информации о них. Всего существует 6 таких свойств:

1.  **debugging** - булевый параметр. Отвечает за режим отладки, при котором
    отображается вся доступная информация о перехваченных ошибках или
    исключениях. Такой режим следует включать на этапе разработки и отключать в
    production версии приложения.

2.  **logging** - булевый параметр, отвечает за логирование ошибок. Логи ошибок
    создаются в виде файлов содержащих сериализованный массив с данными об
    ошибке.

3.  **templateDebug** - путь к файлу шаблона, который используется для
    отображения информации об ошибке.

4.  **templateBug** - путь к файлу шаблона сообщения об ошибке.

5.  **customDebugMethod** - делегат определяющий пользовательский метод анализа
    ошибок и отображения информации о них.

6.  **customLogMethod** - делегат определяющий пользовательский метод
    логирования ошибок.



Существуют также и другие конфигурационные свойства, описывающие поведение
различных модулей фрэймворка. Они будут рассмотрены в соответствующих разделах.



Алиасы папок
------------



Фреймворк предоставляет возможность задавать для одного или нескольких
директорий приложения алиасы (псевдонимы) с последующим получением путей к этим
директориям по их алиасам. Для хранения алиасов служит конфигурационное свойство
**dirs**. Значением свойства является ассоциативный массив. Ключами этого
массива являются алиасы директорий, а значениями - их полные пути относительно
корня сайта.

Некоторые алиасы (например cache, logs и др.) используются фрэймворком для
получения пути к определённым директориям. Все эти алиасы указаны в конфиге по
умолчанию.

Пример секции алиасов конфигурационного INI-файла:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
...
[dirs]
application = "app"
framework   = "lib"
logs        = "app/tmp/logs"
cache       = "app/tmp/cache"
temp        = "app/tmp/null"
ar          = "app/core/model/ar"
...
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Пример задания алиасов в конфигурационном PHP-файле:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<?php

return ['dirs' => ['cache' => 'app/tmp/cache',
                   'logs'  => 'app/tmp/logs',
                   'temp'  => 'app/tmp/null'],
...
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для получения полного пути к директории по её алиасу используется статический
метод **dir** класса **\Aleph**:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
...
echo \Aleph::dir('cache');
...
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Если заданный алиас не соответствует какой-либо директории, то метод **dir**
будет считать этот алиас самостоятельной директорией относительно корня сайта.

Также, помимо метода для получения полного пути к директории, существует
статический метод **url** класса **\Aleph** позволяющий получать относительный
путь (URL) к директории по её алиасу:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
...
echo \Aleph::url('temp');
...
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Так же как и в случае с методом **dir**, если алиас не соответствует какой-либо
директории сайта, то метод **url** посчитает его отдельной директорией.



Загрузка конфигурационного файла
--------------------------------



После того как конфигурационный файл создан, вы можете загрузить его с помощью
метода **config** класса **\Aleph**. Для этого достаточно передать путь к
конфигурационному файлу в качестве первого параметра метода:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
...
$a = \Aleph::getInstance();
$a->config('/path/to/my/config.php');
...
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для того чтобы получить массив конфигурационны данных вам необходимо вызвать
этот же метод без параметров:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
...
$a = \Aleph::getInstance();
// Загружаем данные.
$a->config('/path/to/my/config.php');
// Выводим эти данные в браузер.
print_r($a->config());
...
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Вы также можете загружать данные из нескольких конфигурационных файлов, при этом
произойдёт слияние данных друг с другом.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
...
$a = \Aleph::getInstance();
// Загружаем данные из первого файла.
$a->config('/path/to/my/config.php');
// Загружаем данные из второго файла.
$a->config('/path/to/my/config.ini');
...
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

В этом примере конфигурационные данные из второго файла будут переопределять
конфигурационные данные из первого файла.

Если мы хотим полностью заменить существующие конфигурационные данные другими,
то нам нужно передать в качестве второго параметра метода TRUE (значение по
умолчанию FALSE):

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
...
$a = \Aleph::getInstance();
// Загружаем данные из первого файла.
$a->config('/path/to/my/config.php');
// Заменяем загруженные данные данными из второго файла.
$a->config('/path/to/my/config.ini', true);
...
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Существует возможность загружать конфигурационные данные напрямую из
ассоциативного массива. Как и в случае с файлами, если второй параметр метода
FALSE, то произойдёт слияние новых данных с существующими, в противном случае
данные будут заменены на новые:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
...
$a = \Aleph::getInstance();
// Загружаем данные из первого файла.
$a->config('/path/to/my/config.php');
// Заменяем загруженные данные данными из массива
$a->config(['dirs' => [], 'debugging' => false], true);
...
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~



Работа с конфигурационными данными
----------------------------------



После того как конфигурационные данные загружены вы можете читать
конфигурационные переменные, изменять их значения и удалять. Осуществляется это
через реализацию интерфейса **ArrayAccess** класса **\Aleph**. Другими словами,
вы можете обращаться к объекту **Aleph** как к ассоциативному массиву, элементы
которого соответствуют конфигурационным переменным:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
...
// Получаем объект Aleph.
$a = \Aleph::getInstance();
// Читаем значение свойства foo.
echo $a['foo'];
// Записываем в свойство foo число.
$a['foo'] = 123;
// Удаляем свойство foo.
unset($a['foo']);
// Если требуется получить значение одного конкретного свойства, 
// то можно использовать более компактную форму записи:
echo \Aleph::getInstance()['foo'];
...
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
